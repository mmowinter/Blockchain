<!DOCTYPE html>
<html>
<head>
    <title> Tyme Coin Wallet!</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>   
    <script>
        function generateKey(){
            $.ajax({
                url: "/public_key",
                success: function( result ) {
                    $("#public-key").html(result[0]);
                    // $("#public-key").html("04be128292e3850bb1ec167835d8dae5be4cec21c38b5951a565205c0597a2f7cff12fcc2626e22769d084576f9267db0b3f3157c0b9382220ad47c21cd180fc8f");
                    $("#private-key").html(result[1]);
                    $("#fromAddress").val(result[0]);
                    getBalance();
                    getTransactionHistory();
                }
            });

            $("#public-key").html("Loading...");
            $("#private-key").html("Loading...");
        }

        function getBalance(){
            let add = $("#public-key").html();
            $.ajax({
                url: "/balance?add="+add,
                success: function( result ) {
                    $("#balance-value").html(result);
                }
            });
        }

        function sendCoin(){
            let fromAdd = $("#fromAddress").val();
            let toAdd = $("#toAddress").val();
            let amount = $("#amount").val();
            let privateKey = $("#private-key").html();

            $.ajax({
                url: "/createTransaction?fromAdd="+fromAdd+"&toAdd="+toAdd+"&amount="+amount+"&privateKey="+privateKey,
                success: function( result ) {
                    getTransactionHistory();
                }
            });
        }

        function getTransactionHistory(){
            let add = $("#public-key").html();
            $.ajax({
                url: "/transactionHistory?add="+add,
                success: function( result ) {
                    $("#body-transaction").html("");
                    for(var i = 0; i < result.length; i ++) {
                        var item = result[i];
                        $("#body-transaction").append(
                            `<tr>
                            <td>`+ (i + 1)+`</td>
                            <td>`+item.fromAddress+`</td>
                            <td>`+item.toAddress+`</td>
                            <td>`+item.amount+`</td>
                            <td>`+item.timestamp+`</td>
                        </tr>`
                        );
                    }
                    // $("#balance-value").html(result);
                }
            });
        }

    </script>
</head>
<body>
  <div id="content">
    <div id="head">
        <img src="../" alt="Tyme header"> 
    </div>
    <div id="body">
        <span>Tyme Coin Address: </span><br/>
        <span id="public-key"></span><br/>
        
        <span id="private-key" style="display: none"></span>
        <div id="generate-key">
            <button id="btn-key" name="btn-key" value="Generate" onclick="generateKey();">Generate</button>
        </div>
        <div id="balance">
            <span>Balance: </span><span id="balance-value">0</span>  
        </div>
        <div id="reload-balance">
                <button id="btn-balance" name="btn-balance" value="" onclick="getBalance();getTransactionHistory();">Reload </button>
            </div>
        <div>
            <span>From: </span><input id="fromAddress"/><br/>
            <span>To: </span><input id="toAddress"/><br/>
            <span>Amount: </span><input id="amount"/><br/>
            <button onclick="sendCoin();">Submit</button>
        </div>
        <div id="transaction">
            <table border="1">
                   <tr>
                       <th>No</th>
                       <th>From</th>
                       <th>To</th>
                       <th>Amount</th>
                       <th>Date</th>
                   </tr> 
                   <tbody id="body-transaction">
                  
                </tbody>
            </table>

        </div>
    </div>  

  </div>

</body>

</html>